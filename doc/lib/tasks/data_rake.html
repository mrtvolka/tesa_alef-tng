<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>data.rake - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../#_travis_yml#.html">#.travis.yml#</a>
  
    <li><a href="../../#travis_exercises_csv#.html">#travis_exercises.csv#</a>
  
    <li><a href="../../Capfile.html">Capfile</a>
  
    <li><a href="../../Gemfile.html">Gemfile</a>
  
    <li><a href="../../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../../README_md.html">README</a>
  
    <li><a href="../../Rakefile.html">Rakefile</a>
  
    <li><a href="../../app/assets/images/logo_svg.html">logo.svg</a>
  
    <li><a href="../../app/assets/javascripts/TestSliders_js.html">TestSliders.js</a>
  
    <li><a href="../../app/assets/javascripts/administration_js.html">administration.js</a>
  
    <li><a href="../../app/assets/javascripts/alert_js.html">alert.js</a>
  
    <li><a href="../../app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../../app/assets/javascripts/bootstrap-filestyle_js.html">bootstrap-filestyle.js</a>
  
    <li><a href="../../app/assets/javascripts/bootstrap_js.html">bootstrap.js</a>
  
    <li><a href="../../app/assets/javascripts/contact_js.html">contact.js</a>
  
    <li><a href="../../app/assets/javascripts/exercises_js.html">exercises.js</a>
  
    <li><a href="../../app/assets/javascripts/lib_js.html">lib.js</a>
  
    <li><a href="../../app/assets/javascripts/login_js.html">login.js</a>
  
    <li><a href="../../app/assets/javascripts/main_js.html">main.js</a>
  
    <li><a href="../../app/assets/javascripts/navigation_js.html">navigation.js</a>
  
    <li><a href="../../app/assets/javascripts/progressbar_js.html">progressbar.js</a>
  
    <li><a href="../../app/assets/javascripts/question_js.html">question.js</a>
  
    <li><a href="../../app/assets/javascripts/question_test_js.html">question_test.js</a>
  
    <li><a href="../../app/assets/javascripts/refresh_handler_js.html">refresh_handler.js</a>
  
    <li><a href="../../app/assets/javascripts/scaffold_js_coffee.html">scaffold.js.coffee</a>
  
    <li><a href="../../app/assets/javascripts/slider_js.html">slider.js</a>
  
    <li><a href="../../app/assets/javascripts/teachings_js.html">teachings.js</a>
  
    <li><a href="../../app/assets/javascripts/toggle_js.html">toggle.js</a>
  
    <li><a href="../../app/assets/stylesheets/administration_scss.html">administration.scss</a>
  
    <li><a href="../../app/assets/stylesheets/administration/questions_scss.html">questions.scss</a>
  
    <li><a href="../../app/assets/stylesheets/alerts_scss.html">alerts.scss</a>
  
    <li><a href="../../app/assets/stylesheets/application_scss.html">application.scss</a>
  
    <li><a href="../../app/assets/stylesheets/card_scss.html">card.scss</a>
  
    <li><a href="../../app/assets/stylesheets/exercises_scss.html">exercises.scss</a>
  
    <li><a href="../../app/assets/stylesheets/forms_scss.html">forms.scss</a>
  
    <li><a href="../../app/assets/stylesheets/layout_scss.html">layout.scss</a>
  
    <li><a href="../../app/assets/stylesheets/login_scss.html">login.scss</a>
  
    <li><a href="../../app/assets/stylesheets/navigation_scss.html">navigation.scss</a>
  
    <li><a href="../../app/assets/stylesheets/questions/evaluator_scss.html">evaluator.scss</a>
  
    <li><a href="../../app/assets/stylesheets/questions/questions_scss.html">questions.scss</a>
  
    <li><a href="../../app/assets/stylesheets/questions/questions_answers_scss.html">questions_answers.scss</a>
  
    <li><a href="../../app/assets/stylesheets/setup/alef-iconset-codes_scss.html">alef-iconset-codes.scss</a>
  
    <li><a href="../../app/assets/stylesheets/setup/alef-iconset_scss.html">alef-iconset.scss</a>
  
    <li><a href="../../app/assets/stylesheets/setup/color_scss.html">color.scss</a>
  
    <li><a href="../../app/assets/stylesheets/setup/mixins_scss.html">mixins.scss</a>
  
    <li><a href="../../app/assets/stylesheets/setup/reset_scss.html">reset.scss</a>
  
    <li><a href="../../app/assets/stylesheets/setup/typography_scss.html">typography.scss</a>
  
    <li><a href="../../app/assets/stylesheets/setup/variables_scss.html">variables.scss</a>
  
    <li><a href="../../app/assets/stylesheets/setups_scss.html">setups.scss</a>
  
    <li><a href="../../app/assets/stylesheets/tabs_scss.html">tabs.scss</a>
  
    <li><a href="../../app/assets/stylesheets/teachings_scss.html">teachings.scss</a>
  
    <li><a href="../../app/assets/stylesheets/toggle_scss.html">toggle.scss</a>
  
    <li><a href="../../app/assets/stylesheets/user_element_scss.html">user_element.scss</a>
  
    <li><a href="../../app/assets/stylesheets/weeks_scss.html">weeks.scss</a>
  
    <li><a href="../../azaschedule_csv.html">azaschedule.csv</a>
  
    <li><a href="../../azausers_csv.html">azausers.csv</a>
  
    <li><a href="../../config_ru.html">config.ru</a>
  
    <li><a href="../../config/database_yml_example.html">database.yml.example</a>
  
    <li><a href="../../config/database_yml~.html">database.yml~</a>
  
    <li><a href="../../exercises_csv.html">exercises.csv</a>
  
    <li><a href="../../exercisesdump1_csv.html">exercisesdump1.csv</a>
  
    <li><a href="../../lib/tasks/allinone_rake.html">allinone.rake</a>
  
    <li><a href="../../lib/tasks/aza_setup_rake.html">aza_setup.rake</a>
  
    <li><a href="../../lib/tasks/csvsimple_rake.html">csvsimple.rake</a>
  
    <li><a href="../../lib/tasks/data_rake.html">data.rake</a>
  
    <li><a href="../../lib/tasks/generate_exercises_rake.html">generate_exercises.rake</a>
  
    <li><a href="../../lib/tasks/groups_rake.html">groups.rake</a>
  
    <li><a href="../../lib/tasks/rec_rake.html">rec.rake</a>
  
    <li><a href="../../lib/tasks/testdata_rake.html">testdata.rake</a>
  
    <li><a href="../../lib/tasks/testquestions_rake.html">testquestions.rake</a>
  
    <li><a href="../../log/TEST_log.html">TEST.log</a>
  
    <li><a href="../../log/development_log.html">development.log</a>
  
    <li><a href="../../log/newrelic_agent_log.html">newrelic_agent.log</a>
  
    <li><a href="../../log/test_log.html">test.log</a>
  
    <li><a href="../../otazkyAZA_csv.html">otazkyAZA.csv</a>
  
    <li><a href="../../otazkyTEST_csv.html">otazkyTEST.csv</a>
  
    <li><a href="../../public/404_html.html">404.html</a>
  
    <li><a href="../../public/422_html.html">422.html</a>
  
    <li><a href="../../public/500_html.html">500.html</a>
  
    <li><a href="../../public/assets/application-1d81428a125e8c2912c4ad739eb488e30fa16f65bb1deb92d042fefc90493283_css.html">application-1d81428a125e8c2912c4ad739eb488e30fa16f65bb1deb92d042fefc90493283.css</a>
  
    <li><a href="../../public/assets/application-84332a16d51b238a621e69a32a1e108cf62a0fb0aeae11f2f5eb77a0ebd462c9_js.html">application-84332a16d51b238a621e69a32a1e108cf62a0fb0aeae11f2f5eb77a0ebd462c9.js</a>
  
    <li><a href="../../public/assets/application-9a3d3105fe2bf7bc8ed89e0002d7cc3098a3c3f7d35a6e81bf6e86db3d6f1caf_js.html">application-9a3d3105fe2bf7bc8ed89e0002d7cc3098a3c3f7d35a6e81bf6e86db3d6f1caf.js</a>
  
    <li><a href="../../public/assets/application-a6f534e4364774d88c03826ecfece9df4629492ec87c9c6cd8b59c2548ba5371_css.html">application-a6f534e4364774d88c03826ecfece9df4629492ec87c9c6cd8b59c2548ba5371.css</a>
  
    <li><a href="../../public/assets/logo-8dda0ab4d3da937f0df6862b10c08e5ceb20418c4586ecac816d75d2141501e6_svg.html">logo-8dda0ab4d3da937f0df6862b10c08e5ceb20418c4586ecac816d75d2141501e6.svg</a>
  
    <li><a href="../../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../../public/fonts/alef-iconset_svg.html">alef-iconset.svg</a>
  
    <li><a href="../../public/fonts/config_json.html">config.json</a>
  
    <li><a href="../../public/robots_txt.html">robots</a>
  
    <li><a href="../../schedule_csv.html">schedule.csv</a>
  
    <li><a href="../../travis_exercises_csv.html">travis_exercises.csv</a>
  
    <li><a href="../../travis_question_csv.html">travis_question.csv</a>
  
    <li><a href="../../travis_users_csv.html">travis_users.csv</a>
  
    <li><a href="../../usersdump1_csv.html">usersdump1.csv</a>
  
    <li><a href="../../vendor/assets/javascripts/auto-render_min_js.html">auto-render.min.js</a>
  
    <li><a href="../../vendor/assets/javascripts/detect-zoom_js.html">detect-zoom.js</a>
  
    <li><a href="../../vendor/assets/javascripts/ifvisible_js.html">ifvisible.js</a>
  
    <li><a href="../../vendor/assets/javascripts/jquery_floatThead_min_js.html">jquery.floatThead.min.js</a>
  
    <li><a href="../../vendor/assets/javascripts/katex_min_js.html">katex.min.js</a>
  
    <li><a href="../../vendor/assets/javascripts/time-me_js.html">time-me.js</a>
  
    <li><a href="../../vendor/assets/stylesheets/katex_css.html">katex.css</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page lib/tasks/data.rake">

<p>require &#39;rubygems&#39; require &#39;nokogiri&#39; require
&#39;open-uri&#39; require &#39;pandoc-ruby&#39; require &#39;csv&#39;</p>

<p>namespace :alef do</p>

<pre class="ruby"><span class="ruby-identifier">namespace</span> :<span class="ruby-identifier">data</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># import questions from ALEF docbook environment</span>
  <span class="ruby-comment"># run:</span>
  <span class="ruby-comment">#   rake alef:data:import_xml[&#39;xml_dir&#39;]</span>
  <span class="ruby-identifier">task</span> :<span class="ruby-identifier">import_xml</span>, [:<span class="ruby-identifier">directory</span>]  =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">environment</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span>, <span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">directory</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">directory</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;   &quot;</span>

    <span class="ruby-identifier">files</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">directory</span>)
    <span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
      <span class="ruby-comment"># open file</span>
      <span class="ruby-ivar">@doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>))
      <span class="ruby-identifier">question</span> = <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">at</span>(<span class="ruby-string">&#39;//alef:question&#39;</span>) <span class="ruby-comment">#question_type</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">question</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;single-choice&quot;</span>
        <span class="ruby-identifier">question_type</span> = <span class="ruby-string">&quot;SingleChoiceQuestion&quot;</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">question</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;multi-choice&quot;</span>
        <span class="ruby-identifier">question_type</span> = <span class="ruby-string">&quot;MultiChoiceQuestion&quot;</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">question</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;answer-validator&quot;</span>
        <span class="ruby-identifier">question_type</span> = <span class="ruby-string">&quot;EvaluatorQuestion&quot;</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">question_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;SingleChoiceQuestion&quot;</span>  <span class="ruby-operator">||</span> <span class="ruby-identifier">question_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;MultiChoiceQuestion&quot;</span>
        <span class="ruby-identifier">description</span> = <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">at</span>(<span class="ruby-string">&#39;//alef:description&#39;</span>) <span class="ruby-comment">#question_text</span>

        <span class="ruby-ivar">@converted_description</span> = <span class="ruby-constant">PandocRuby</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">description</span>.<span class="ruby-identifier">content</span>, :<span class="ruby-identifier">from</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">docbook</span>, :<span class="ruby-identifier">to</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">markdown</span>)
        <span class="ruby-comment">#puts @converted_description.convert</span>

        <span class="ruby-identifier">lo</span> = <span class="ruby-constant">LearningObject</span>.<span class="ruby-identifier">create!</span>( <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">question_type</span>, <span class="ruby-identifier">question_text</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@converted_description</span>.<span class="ruby-identifier">convert</span> )

        <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">&#39;  /alef:choice&#39;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>[<span class="ruby-string">&#39;correct&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;true&quot;</span>
            <span class="ruby-identifier">correct_answer</span> = <span class="ruby-keyword">true</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">correct_answer</span> = <span class="ruby-keyword">false</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-ivar">@converted_answer</span> = <span class="ruby-constant">PandocRuby</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">node</span>.<span class="ruby-identifier">content</span>, :<span class="ruby-identifier">from</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">docbook</span>, :<span class="ruby-identifier">to</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">markdown</span>)
          <span class="ruby-comment">#puts @converted_answer.convert</span>
          <span class="ruby-comment">#puts &quot;***&quot;</span>

          <span class="ruby-constant">Answer</span>.<span class="ruby-identifier">create!</span>( <span class="ruby-identifier">learning_object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">lo</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">answer_text</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@converted_answer</span>.<span class="ruby-identifier">convert</span>, <span class="ruby-identifier">is_correct</span><span class="ruby-operator">:</span> <span class="ruby-identifier">correct_answer</span> )
          <span class="ruby-comment">#puts node.content</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment">#puts description.content + &#39; ; &#39; + question[&#39;type&#39;]</span>

      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">question_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;EvaluatorQuestion&quot;</span>

        <span class="ruby-identifier">description</span> = <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">at</span>(<span class="ruby-string">&#39;//alef:description&#39;</span>) <span class="ruby-comment">#question_text</span>

        <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">&#39;*//alef:answer&#39;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>

          <span class="ruby-ivar">@converted_description</span> = <span class="ruby-constant">PandocRuby</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">description</span>.<span class="ruby-identifier">content</span>, :<span class="ruby-identifier">from</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">docbook</span>, :<span class="ruby-identifier">to</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">markdown</span>)
          <span class="ruby-comment">#puts @converted_description.convert</span>

          <span class="ruby-identifier">lo</span> = <span class="ruby-constant">LearningObject</span>.<span class="ruby-identifier">create!</span>( <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">question_type</span>, <span class="ruby-identifier">question_text</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@converted_description</span>.<span class="ruby-identifier">convert</span> )

          <span class="ruby-ivar">@converted_answer</span> = <span class="ruby-constant">PandocRuby</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">node</span>.<span class="ruby-identifier">content</span>, :<span class="ruby-identifier">from</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">docbook</span>, :<span class="ruby-identifier">to</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">markdown</span>)
          <span class="ruby-comment">#puts @converted_answer.convert</span>
          <span class="ruby-comment">#puts &quot;***&quot;</span>

          <span class="ruby-constant">Answer</span>.<span class="ruby-identifier">create!</span>( <span class="ruby-identifier">learning_object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">lo</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">answer_text</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@converted_answer</span>.<span class="ruby-identifier">convert</span> )
          <span class="ruby-comment">#puts node.content</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment">#puts description.content + &#39; ; &#39; + question[&#39;type&#39;]</span>

      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">## ---------------------------------------------------------------------------------</span>
  <span class="ruby-comment">## CSV IMPORT</span>
  <span class="ruby-comment">## ---------------------------------------------------------------------------------</span>
  <span class="ruby-constant">IMPORTED_QUESTION_TYPES</span> = {
      <span class="ruby-string">&#39;single-choice&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;SingleChoiceQuestion&#39;</span>,
      <span class="ruby-string">&#39;multi-choice&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;MultiChoiceQuestion&#39;</span>,
      <span class="ruby-string">&#39;answer-validator&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;EvaluatorQuestion&#39;</span>,
      <span class="ruby-string">&#39;complement&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Complement&#39;</span>
  }

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">convert_format</span>(<span class="ruby-identifier">source_string</span>, <span class="ruby-identifier">is_answer</span> = <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">is_answer</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">source_string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&lt;correct&gt;|&lt;\/correct&gt;/</span>,<span class="ruby-string">&#39;&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">source_string</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">import_difficulty</span>(<span class="ruby-identifier">difficulty_string</span>, <span class="ruby-identifier">learning_object</span>)
    <span class="ruby-identifier">difficulty_levels</span> = {
        <span class="ruby-string">&#39;trivialne&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">LearningObject</span><span class="ruby-operator">::</span><span class="ruby-constant">DIFFICULTY</span>[:<span class="ruby-constant">TRIVIAL</span>],
        <span class="ruby-string">&#39;lahke&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">LearningObject</span><span class="ruby-operator">::</span><span class="ruby-constant">DIFFICULTY</span>[:<span class="ruby-constant">EASY</span>],
        <span class="ruby-string">&#39;stredne&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">LearningObject</span><span class="ruby-operator">::</span><span class="ruby-constant">DIFFICULTY</span>[:<span class="ruby-constant">MEDIUM</span>],
        <span class="ruby-string">&#39;tazke&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">LearningObject</span><span class="ruby-operator">::</span><span class="ruby-constant">DIFFICULTY</span>[:<span class="ruby-constant">HARD</span>],
        <span class="ruby-string">&#39;impossible&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">LearningObject</span><span class="ruby-operator">::</span><span class="ruby-constant">DIFFICULTY</span>[:<span class="ruby-constant">IMPOSSIBLE</span>]
    }

    <span class="ruby-identifier">difficulty</span> = <span class="ruby-identifier">difficulty_levels</span>[<span class="ruby-identifier">difficulty_string</span>.<span class="ruby-identifier">andand</span>.<span class="ruby-identifier">strip</span>]
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">difficulty</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;WARNING: &#39;#{learning_object.external_reference}&#39; - &#39;#{learning_object.lo_id}&#39; has unrecognized difficulty string: &#39;#{difficulty_string.inspect}&#39;&quot;</span>
      <span class="ruby-identifier">difficulty</span> = <span class="ruby-constant">LearningObject</span><span class="ruby-operator">::</span><span class="ruby-constant">DIFFICULTY</span>[:<span class="ruby-constant">UNKNOWN</span>]
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">learning_object</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">difficulty</span><span class="ruby-operator">:</span> <span class="ruby-identifier">difficulty</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">import_concepts</span>(<span class="ruby-identifier">concepts_string</span>,<span class="ruby-identifier">learning_object</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">concepts_string</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">concepts_string</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;WARNING: &#39;#{learning_object.external_reference}&#39; - &#39;#{learning_object.lo_id}&#39; has no concepts&quot;</span>
      <span class="ruby-identifier">concepts_string</span> = <span class="ruby-constant">Concept</span><span class="ruby-operator">::</span><span class="ruby-constant">DUMMY_CONCEPT_NAME</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">concept_names</span> = <span class="ruby-identifier">concepts_string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">strip</span>}
    <span class="ruby-identifier">concept_names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">concept_name</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">concept</span> = <span class="ruby-constant">Concept</span>.<span class="ruby-identifier">find_or_create_by</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">concept_name</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">c</span>.<span class="ruby-identifier">course</span> = <span class="ruby-constant">Course</span>.<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">c</span>.<span class="ruby-identifier">pseudo</span> = (<span class="ruby-identifier">concept_name</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Concept</span><span class="ruby-operator">::</span><span class="ruby-constant">DUMMY_CONCEPT_NAME</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">learning_object</span>.<span class="ruby-identifier">link_concept</span>(<span class="ruby-identifier">concept</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">learning_object</span>.<span class="ruby-identifier">concepts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">learning_object</span>.<span class="ruby-identifier">concepts</span>.<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">concept_names</span>))
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">import_pictures</span>(<span class="ruby-identifier">picture</span>, <span class="ruby-identifier">pictures_dir</span>, <span class="ruby-identifier">lo</span>)
    <span class="ruby-identifier">picture</span> = <span class="ruby-identifier">picture</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>).<span class="ruby-identifier">last</span>

    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">image</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">pictures_dir</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">picture</span>)
      <span class="ruby-constant">LearningObject</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">lo</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">image</span><span class="ruby-operator">:</span> <span class="ruby-identifier">image</span>)
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;IMAGE MISSING: #{picture}&quot;</span>
      <span class="ruby-identifier">raise</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># CSV structure</span>
  <span class="ruby-comment"># 0    1                     2                                    3                    4</span>
  <span class="ruby-comment"># ID,  Obrazok,              Nazov,                               Kategoria,           Do nultej verzie,</span>
  <span class="ruby-comment"># 510, resources/q-001pl.png, Hrany v diagrame prípadov použitia, funkcionalne_modely, y,</span>
  <span class="ruby-comment"># 5                 6                                 7                       8</span>
  <span class="ruby-comment"># Otazka,           Koncepty,                         Kapitola,               Subkapitola,</span>
  <span class="ruby-comment"># &quot;Akého typu...?&quot;, &quot;UML, diagram prípadov použitia&quot;, 07 Funkcionálne modely, 07.01 Model a diagram prípadov použitia,</span>
  <span class="ruby-comment"># 9              10               11</span>
  <span class="ruby-comment"># Typ otazky,    Spravna odpoved, &quot;Moznosti, ak boli k dispozicii&quot;,</span>
  <span class="ruby-comment"># single-choice, extend;,         asociácia;&lt;correct&gt;extend&lt;/correct&gt;;uses;dedenie;use;include;,</span>
  <span class="ruby-comment"># 12                                                     13</span>
  <span class="ruby-comment"># Obtiaznost (impossible/tazke/stredne/lahke/trivialne), XML</span>
  <span class="ruby-comment"># ,                                                      questions/psi-op-q-006pl.xml</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">import_choice_questions</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">pictures_dir</span>)
    <span class="ruby-constant">CSV</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">file</span>, :<span class="ruby-identifier">headers</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">external_reference</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">0</span>]
      <span class="ruby-identifier">picture</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">1</span>]
      <span class="ruby-identifier">question_name</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>
      <span class="ruby-identifier">zero_version</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">4</span>]
      <span class="ruby-identifier">question_text</span> = <span class="ruby-identifier">convert_format</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">5</span>])
      <span class="ruby-identifier">concept_names</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">6</span>]
      <span class="ruby-identifier">question_type</span> = <span class="ruby-constant">IMPORTED_QUESTION_TYPES</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">9</span>]]
      <span class="ruby-identifier">answers</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">11</span>]
      <span class="ruby-identifier">difficulty_text</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">12</span>]

      <span class="ruby-comment"># import only tagged questions</span>
      <span class="ruby-comment"># next unless zero_version == &#39;y&#39;</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">question_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;Complement&#39;</span>

      <span class="ruby-identifier">lo</span> = <span class="ruby-constant">LearningObject</span>.<span class="ruby-identifier">find_or_create_by</span>(<span class="ruby-identifier">external_reference</span><span class="ruby-operator">:</span> <span class="ruby-identifier">external_reference</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lo</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">lo</span>.<span class="ruby-identifier">course</span> = <span class="ruby-constant">Course</span>.<span class="ruby-identifier">first</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">lo</span>.<span class="ruby-identifier">update</span>( <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">question_type</span>, <span class="ruby-identifier">lo_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">question_name</span>, <span class="ruby-identifier">question_text</span><span class="ruby-operator">:</span> <span class="ruby-identifier">question_text</span> )

      <span class="ruby-comment"># TODO import answers when updating existing LO, not only upon first creation</span>
      <span class="ruby-comment"># ^NOTE: answer ID should be preserved whenever possible for logged relations</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">lo</span>.<span class="ruby-identifier">answers</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">answers</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;;&#39;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">answer</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">correct_answer</span> = <span class="ruby-identifier">answer</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&#39;&lt;correct&gt;&#39;</span>
          <span class="ruby-identifier">answer_text</span> = <span class="ruby-identifier">convert_format</span>(<span class="ruby-identifier">answer</span>, <span class="ruby-keyword">true</span>)
          <span class="ruby-constant">Answer</span>.<span class="ruby-identifier">create!</span>( <span class="ruby-identifier">learning_object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">lo</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">answer_text</span><span class="ruby-operator">:</span> <span class="ruby-identifier">answer_text</span>, <span class="ruby-identifier">is_correct</span><span class="ruby-operator">:</span> <span class="ruby-identifier">correct_answer</span> )
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">import_difficulty</span>(<span class="ruby-identifier">difficulty_text</span>, <span class="ruby-identifier">lo</span>)
      <span class="ruby-identifier">import_concepts</span>(<span class="ruby-identifier">concept_names</span>, <span class="ruby-identifier">lo</span>)
      <span class="ruby-identifier">import_pictures</span>(<span class="ruby-identifier">picture</span>, <span class="ruby-identifier">pictures_dir</span>, <span class="ruby-identifier">lo</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">picture</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># CSV structure:</span>
  <span class="ruby-comment"># 0           1           2           3                 4           5                  6</span>
  <span class="ruby-comment"># ID Otazka,  ID odpoved, ID_Sypanie, Do nultej verzie, Vybrať (Y), Nazvova kategoria, Nazov (specificky),</span>
  <span class="ruby-comment"># 1072799564, 10,         836,        y,                Y,          diagram,           Určovanie typu diagramu,</span>
  <span class="ruby-comment"># 7                                          8</span>
  <span class="ruby-comment"># Koncepty,                                  Obtiaznost (impossible/tazke/stredne/lahke/trivialne),</span>
  <span class="ruby-comment"># &quot;UML,štruktúrny diagram,diagram objektov&quot;, lahke,</span>
  <span class="ruby-comment"># 9               10</span>
  <span class="ruby-comment"># Otazka,         Image url,</span>
  <span class="ruby-comment"># Aký diagram..., http://alef.fiit.stuba.sk/learning_objects/resources/pic-psi-sg-q-0.png,</span>
  <span class="ruby-comment"># 11</span>
  <span class="ruby-comment"># Odpoved,</span>
  <span class="ruby-comment"># Object diagram (Objektovy diagram) Patri do UML.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">import_qalo_questions</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">pictures_dir</span>)
    <span class="ruby-constant">CSV</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">file</span>, :<span class="ruby-identifier">headers</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">external_reference</span> = <span class="ruby-node">&quot;#{row[0]}:#{row[1]}&quot;</span>
      <span class="ruby-identifier">zero_version</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">4</span>]   <span class="ruby-comment"># using new selector</span>
      <span class="ruby-identifier">question_name</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">6</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>
      <span class="ruby-identifier">concept_names</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">7</span>]
      <span class="ruby-identifier">difficulty_text</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">8</span>]
      <span class="ruby-identifier">question_text</span> = <span class="ruby-identifier">convert_format</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">9</span>])
      <span class="ruby-identifier">picture</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">10</span>]
      <span class="ruby-identifier">answer_text</span> = <span class="ruby-identifier">convert_format</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">11</span>], <span class="ruby-keyword">true</span>)
      <span class="ruby-identifier">question_type</span> = <span class="ruby-string">&#39;EvaluatorQuestion&#39;</span>

      <span class="ruby-comment"># import only tagged questions</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">zero_version</span>.<span class="ruby-identifier">andand</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;Y&#39;</span>

      <span class="ruby-identifier">lo</span> = <span class="ruby-constant">LearningObject</span>.<span class="ruby-identifier">find_or_create_by</span>(<span class="ruby-identifier">external_reference</span><span class="ruby-operator">:</span> <span class="ruby-identifier">external_reference</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lo</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">lo</span>.<span class="ruby-identifier">course</span> = <span class="ruby-constant">Course</span>.<span class="ruby-identifier">first</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">lo</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">question_type</span>, <span class="ruby-identifier">lo_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">question_name</span>, <span class="ruby-identifier">question_text</span><span class="ruby-operator">:</span> <span class="ruby-identifier">question_text</span>)

      <span class="ruby-constant">Answer</span>.<span class="ruby-identifier">find_or_create_by</span>(<span class="ruby-identifier">learning_object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">lo</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">update</span>(<span class="ruby-identifier">answer_text</span><span class="ruby-operator">:</span> <span class="ruby-identifier">answer_text</span>)

      <span class="ruby-identifier">import_difficulty</span>(<span class="ruby-identifier">difficulty_text</span>, <span class="ruby-identifier">lo</span>)
      <span class="ruby-identifier">import_concepts</span>(<span class="ruby-identifier">concept_names</span>, <span class="ruby-identifier">lo</span>)
      <span class="ruby-identifier">import_pictures</span>(<span class="ruby-identifier">picture</span>, <span class="ruby-identifier">pictures_dir</span>, <span class="ruby-identifier">lo</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">picture</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># import questions from CSV files</span>
  <span class="ruby-comment"># run:</span>
  <span class="ruby-comment">#    rake alef:data:import_csv[&quot;QALO.csv&quot;,&quot;choices.csv&quot;,&quot;img_dir&quot;]</span>
  <span class="ruby-identifier">task</span> :<span class="ruby-identifier">import_csv</span>, [:<span class="ruby-identifier">qalo_csv</span>, :<span class="ruby-identifier">choice_csv</span>, :<span class="ruby-identifier">img_dir</span>] =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">environment</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span>, <span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">import_choice_questions</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">choice_csv</span>, <span class="ruby-identifier">args</span>.<span class="ruby-identifier">img_dir</span>)
    <span class="ruby-identifier">import_qalo_questions</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">qalo_csv</span>, <span class="ruby-identifier">args</span>.<span class="ruby-identifier">img_dir</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>end</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

